<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø£Ø¯Ø§Ø© ÙØ­Øµ Ø§Ù„Ø±ÙˆØ§Ø¨Ø·</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="scanner-container">
    <img src="/assets/blackmirror_logo.png" alt="Black Mirror Logo" class="logo">
    <h2>ğŸ” ÙØ­Øµ Ø±Ø§Ø¨Ø· Ù…Ø´Ø¨ÙˆÙ‡</h2>
    <form>
      <input type="text" id="url" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§" required>
      <button type="submit">ÙØ­Øµ Ø§Ù„Ø±Ø§Ø¨Ø·</button>
    </form>
    <p id="result" class="result-text"></p>
  </div>

  <!-- ÙƒÙˆØ¯ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ù…Ù† Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± -->
  <script>
    document.addEventListener("keydown", function (e) {
      if (
        e.key === "F12" ||
        (e.ctrlKey && e.shiftKey && (e.key === "I" || e.key === "C" || e.key === "J")) ||
        (e.ctrlKey && e.key === "U")
      ) {
        e.preventDefault();
      }
    });
    document.addEventListener("contextmenu", function (e) {
      e.preventDefault();
    });
  </script>

  <!-- ÙƒÙˆØ¯ ÙØ­Øµ Ø§Ù„Ø±Ø§Ø¨Ø· + Ø²Ø± Ø§Ù„Ø¥Ø¨Ù„Ø§Øº -->
  <script>
    const form = document.querySelector("form");
    const urlInput = document.getElementById("url");
    const resultText = document.getElementById("result");

    let reportButton;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const url = urlInput.value.trim();

      resultText.textContent = "ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙØ­Øµ...";
      resultText.style.color = "gray";

      if (reportButton) {
        reportButton.remove();
        reportButton = null;
      }

      try {
        const response = await fetch("/check-url", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ url })
        });

        const data = await response.json();

        if (data.safe) {
          resultText.textContent = "âœ… Ø§Ù„Ø±Ø§Ø¨Ø· Ø¢Ù…Ù†";
          resultText.style.color = "green";
        } else {
          resultText.textContent = "ğŸš« Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø´Ø¨ÙˆÙ‡: " + (data.info || "ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù†Ù‡ ÙƒÙ…ÙˆÙ‚Ø¹ Ø®Ø·ÙŠØ±");
          resultText.style.color = "red";

          reportButton = document.createElement("button");
          reportButton.textContent = "ğŸ“© Ø§Ù„Ø¥Ø¨Ù„Ø§Øº Ø¹Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØªØµÙŠØ¯";
          reportButton.style.marginTop = "1rem";
          form.appendChild(reportButton);

          reportButton.addEventListener("click", async (event) => {
            event.preventDefault();
            try {
              const res = await fetch("/report-url", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json"
                },
                body: JSON.stringify({ url })
              });

              const result = await res.json();
              if (result.success) {
                resultText.textContent = "âœ… ØªÙ… Ø§Ù„Ø¥Ø¨Ù„Ø§ØºØŒ Ø´ÙƒØ±Ù‹Ø§ Ù„Ù…Ø³Ø§Ù‡Ù…ØªÙƒ.";
                resultText.style.color = "blue";
                reportButton.remove();
                reportButton = null;
              } else {
                resultText.textContent = "âš ï¸ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº.";
                resultText.style.color = "orange";
              }
            } catch (err) {
              resultText.textContent = "âš ï¸ Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¥Ø¨Ù„Ø§Øº: " + err.message;
              resultText.style.color = "red";
            }
          });
        }
      } catch (err) {
        resultText.textContent = "âš ï¸ Ø­Ø¯Ø« Ø®Ø·Ø£: " + err.message;
        resultText.style.color = "red";
      }
    });
  </script>
</body>
</html>
